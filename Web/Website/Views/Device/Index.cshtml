@using Roomie.Web.Persistence.Helpers
@model IEnumerable<Roomie.Web.Persistence.Models.DeviceModel>
@{
    ViewBag.Title = "Devices";
}@*

*@@section PageSpecificScripts{@*
    *@<script type="text/javascript">updateDevicesContinuously();</script>@*
*@}@*

*@@if (Model == null || !Model.Any())
{
    @Html.Partial("Partials/BotMessage/Empty")
}
else
  {
    DeviceLocationModel lastLocation = null;
    foreach (var device in Model)
    {
        if (lastLocation.CompareByParts(device.Location) != 0)
        {
            var lastLocationParts = (lastLocation == null) ? new string[0] : lastLocation.GetParts().ToArray();
            var locationParts = device.Location.GetParts().ToArray();
            
            if (locationParts.Length > 0)
            {
                for (var i = 0; i < locationParts.Length; i++)
                {
                    if (i >= lastLocationParts.Length || lastLocationParts[i] != locationParts[i])
                    {
                        var headerNumber = i + 2;
                        @Html.Raw("<h" + headerNumber + ">" + locationParts[i] + "</h" + headerNumber + ">")
                    }
                    
                }
            }
        }

        lastLocation = device.Location;
        
        var deviceViewModel = new DeviceViewModel(device, Url);
        
        @Html.Partial(
                partialViewName: "Partials/Device/Device",
                 model: deviceViewModel
        )
    }
}